<!DOCTYPE html>
<html>
<head>
    <title>MotoRev Database - Simple View</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #667eea; color: white; padding: 20px; text-align: center; }
        .nav { display: flex; background: #f0f0f0; }
        .nav button { padding: 15px 20px; border: none; background: #f0f0f0; cursor: pointer; }
        .nav button:hover { background: #e0e0e0; }
        .nav button.active { background: white; }
        .content { padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #f5f5f5; }
        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 4px; }
        .success { background: #e8f5e8; color: #2e7d32; padding: 15px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸï¸ MotoRev Database Viewer (Simple)</h1>
    </div>
    
    <div class="nav">
        <button onclick="loadData('users')" class="active" id="users-btn">Users</button>
        <button onclick="loadData('posts')" id="posts-btn">Posts</button>
        <button onclick="loadData('rides')" id="rides-btn">Rides</button>
        <button onclick="loadData('stories')" id="stories-btn">Stories</button>
        <button onclick="loadData('emergency_events')" id="emergency-btn">Emergencies</button>
        <button onclick="loadData('hazard_reports')" id="hazard-btn">Hazards</button>
        <button onclick="loadStats()" id="stats-btn">Statistics</button>
    </div>
    
    <div class="content" id="content">
        <div>ğŸ”„ Loading users data automatically...</div>
    </div>

    <script>
        console.log('ğŸš€ Simple Database Viewer Starting');
        
        async function loadData(table) {
            console.log('ğŸ“Š Loading table:', table);
            const content = document.getElementById('content');
            content.innerHTML = '<div>ğŸ”„ Loading ' + table + '...</div>';
            
            // Update button states
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(table + '-btn') || document.querySelector('[onclick*="' + table + '"]');
            if (activeBtn) activeBtn.classList.add('active');
            
            try {
                console.log('ğŸ“¡ Fetching: /api/admin/table/' + table);
                const response = await fetch('/api/admin/table/' + table);
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                }
                
                const data = await response.json();
                console.log('âœ… Data received:', data);
                
                if (!data.rows || data.rows.length === 0) {
                    content.innerHTML = '<div class="error">ğŸ“­ No data in ' + table + ' table</div>';
                    return;
                }
                
                let html = '<h2>ğŸ—‚ï¸ ' + table.toUpperCase() + ' (' + data.rows.length + ' records)</h2>';
                html += '<table><tr>';
                
                // Headers
                const headers = Object.keys(data.rows[0]);
                headers.forEach(key => {
                    html += '<th>' + key + '</th>';
                });
                html += '</tr>';
                
                // Rows (limit to first 20 for performance)
                const rowsToShow = data.rows.slice(0, 20);
                rowsToShow.forEach(row => {
                    html += '<tr>';
                    headers.forEach(header => {
                        let val = row[header];
                        if (val === null) val = '<em>null</em>';
                        if (typeof val === 'string' && val.length > 50) val = val.substring(0, 50) + '...';
                        html += '<td>' + val + '</td>';
                    });
                    html += '</tr>';
                });
                
                html += '</table>';
                if (data.rows.length > 20) {
                    html += '<p><em>Showing first 20 of ' + data.rows.length + ' records</em></p>';
                }
                html += '<div class="success">âœ… Loaded ' + data.rows.length + ' ' + table + ' records</div>';
                content.innerHTML = html;
                
                console.log('âœ… Table displayed successfully');
                
            } catch (error) {
                console.error('âŒ Error loading table:', error);
                content.innerHTML = '<div class="error">âŒ Error loading ' + table + ': ' + error.message + '</div>';
            }
        }
        
        async function loadStats() {
            console.log('ğŸ“ˆ Loading statistics');
            const content = document.getElementById('content');
            content.innerHTML = '<div>ğŸ”„ Loading statistics...</div>';
            
            // Update button states
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('stats-btn').classList.add('active');
            
            try {
                console.log('ğŸ“¡ Fetching: /api/admin/stats');
                const response = await fetch('/api/admin/stats');
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                }
                
                const stats = await response.json();
                console.log('âœ… Stats received:', stats);
                
                let html = '<h2>ğŸ“Š Database Statistics</h2><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">';
                
                Object.entries(stats).forEach(([key, value]) => {
                    const label = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    html += '<div style="background: #667eea; color: white; padding: 20px; border-radius: 8px; text-align: center;">';
                    html += '<div style="font-size: 2em; font-weight: bold;">' + value + '</div>';
                    html += '<div>' + label + '</div>';
                    html += '</div>';
                });
                
                html += '</div>';
                html += '<div class="success" style="margin-top: 20px;">âœ… Statistics loaded successfully</div>';
                content.innerHTML = html;
                
                console.log('âœ… Stats displayed successfully');
                
            } catch (error) {
                console.error('âŒ Error loading stats:', error);
                content.innerHTML = '<div class="error">âŒ Error loading statistics: ' + error.message + '</div>';
            }
        }
        
        // Multiple auto-load strategies
        console.log('â³ Setting up auto-load...');
        
        function autoLoad() {
            console.log('ğŸ¯ Auto-loading users table...');
            setTimeout(() => {
                loadData('users');
            }, 500); // Small delay to ensure everything is ready
        }
        
        // Strategy 1: Immediate
        if (document.readyState === 'complete') {
            console.log('âœ… Document already complete, loading immediately');
            autoLoad();
        } else if (document.readyState === 'interactive') {
            console.log('âœ… Document interactive, loading soon');
            autoLoad();
        } else {
            console.log('â³ Document still loading, waiting for DOMContentLoaded');
            document.addEventListener('DOMContentLoaded', function() {
                console.log('âœ… DOMContentLoaded fired');
                autoLoad();
            });
        }
        
        // Strategy 2: Backup timer
        setTimeout(() => {
            console.log('ğŸ”„ Backup timer checking...');
            const content = document.getElementById('content');
            if (content && content.innerHTML.includes('Loading users data automatically')) {
                console.log('ğŸš¨ Still showing loading message, forcing load');
                loadData('users');
            }
        }, 2000);
        
        console.log('âœ… Script setup complete');
    </script>
</body>
</html> 